<?xml version='1.0' encoding='windows-1252'?>
<Wix xmlns='http://schemas.microsoft.com/wix/2006/wi'>
  <?include Includes.wxi?>
  <Product
	UpgradeCode="B49D2664-0941-465d-A704-CAC63D1D0789"
	Name="$(var.ProductName) $(var.VersionNumberUserVisible)"
	Id='*'
	Language='1033'
	Codepage='1252'
	Version="$(var.VersionNumberInternal)"
	Manufacturer='Stefans Tools'>

    <Package Id='*' Keywords='Installer'
		  Description="Subversion Commit Monitor"
		  Comments='http://tools.tortoisesvn.net' Manufacturer='Stefans Tools'
		  InstallerVersion='100' Languages='1033' Compressed='yes' SummaryCodepage='1252' />

    <Upgrade Id="B49D2664-0941-465d-A704-CAC63D1D0789" >
      <!-- flag is set if the install will trigger an upgrade of an existing install -->
      <UpgradeVersion Property="PREVIOUSVERSIONSINSTALLED" Maximum="$(var.VersionNumberInternal)" IncludeMaximum="no" />
    </Upgrade>

    <Media Id='1' Cabinet='cmtmonitor.cab' EmbedCab='yes' />
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" />
    <Condition Message='This application only runs on Windows 2000 and later.'>VersionNT &gt;= 500</Condition>

    <!-- define directory structure -->
    <Directory Id='TARGETDIR' Name='SourceDir'>
      <Directory Id='ProgramFilesFolder' Name='PFiles'>
        <Directory Id='INSTALLDIR' Name='CommitMonitor'/>
      </Directory>
      <Directory Id="ProgramMenuFolder" Name="Programs">
        <Directory Id="ProgramMenuDir" Name="CommitMonitor" />
      </Directory>
    </Directory>

    <!-- set up the components in the directory structure -->
    <DirectoryRef Id="INSTALLDIR">
      <Component Id='MainEXE' Guid='325E1EEF-97EE-4b0e-8FCB-7A0CADE42934'>
        <File Id='CommitMonitor.EXE' Name='CommitMonitor.exe' DiskId='1' Source='../../bin/release/CommitMonitor.exe' Vital='yes'>
        </File>
      </Component>
      <Component Id="C__sasl" Guid="44E0376D-ACFF-422f-A372-0AB08A1F7EE1" >
        <File Id="F__libsasl" Name="libsasl.dll" DiskId="1" Source="../../bin/release/libsasl.dll" KeyPath="yes" />
        <File Id="F__saslANONYMOUS" Name="saslANONYMOUS.dll" DiskId="1" Source="../../bin/release/saslANONYMOUS.dll" />
        <File Id="F__saslCRAMMD5" Name="saslCRAMMD5.dll" DiskId="1" Source="../../bin/release/saslCRAMMD5.dll" />
        <File Id="F__saslDIGESTMD5" Name="saslDIGESTMD5.dll" DiskId="1" Source="../../bin/release/saslDIGESTMD5.dll" />
        <File Id="F__saslLOGIN" Name="saslLOGIN.dll" DiskId="1" Source="../../bin/release/saslLOGIN.dll" />
        <File Id="F__saslNTLM" Name="saslNTLM.dll" DiskId="1" Source="../../bin/release/saslNTLM.dll" />
        <File Id="F__saslPLAIN" Name="saslPLAIN.dll" DiskId="1" Source="../../bin/release/saslPLAIN.dll" />
      </Component>
    </DirectoryRef>

    <DirectoryRef Id="ProgramMenuDir">
      <Component Id="StartMenuShortCut" Guid='CD0F0582-4A66-4904-9DB1-800D60AB07C9'>
        <Shortcut Id="startMenuCommitMonitor" Directory="ProgramMenuDir" Name="CommitMonitor" Target="[INSTALLDIR]CommitMonitor.exe" Description="Subversion Commit Monitor" />
        <RemoveFolder Id="ProgramMenuDir" On="uninstall"/>
        <RegistryValue Root="HKCU" Key="Software\Microsoft\CommitMonitor" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
      </Component>
    </DirectoryRef>

    <Feature Id='Complete' Title='CommitMonitor' Description='The complete package.'
		  Display='expand' Level='1' ConfigurableDirectory='INSTALLDIR'>
      <Feature Id='MainEXE' Title='Program' Description='The main executable.' Level='1'>
        <ComponentRef Id='MainEXE' />
        <ComponentRef Id='StartMenuShortCut' />
        <ComponentRef Id='C__sasl' />
      </Feature>
    </Feature>

    <UIRef Id="WixUI_InstallDir" />
    <WixVariable Id="WixUILicenseRtf" Value="License.rtf" />
    <WixVariable Id="WixUIBannerBmp" Value="include\Banner.jpg" />
    <WixVariable Id="WixUIDialogBmp" Value="include\Dialog.jpg" />

    <InstallExecuteSequence>
      <AppSearch Sequence="1"></AppSearch>
      <LaunchConditions After="AppSearch" />
      <RemoveExistingProducts After="InstallValidate"><![CDATA[PREVIOUSVERSIONSINSTALLED]]></RemoveExistingProducts>
    </InstallExecuteSequence>

  </Product>
</Wix>
